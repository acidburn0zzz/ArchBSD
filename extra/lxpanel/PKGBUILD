pkgname=lxpanel
pkgver=0.5.12
pkgrel=1
pkgdesc='Lightweight X11 desktop panel for LXDE'
arch=('i686' 'x86_64')
license=('GPL2')
url='http://lxde.org/'
groups=('lxde')
depends=('gtk2' 'menu-cache' 'lxmenu-data' 'libwnck')
makedepends=('docbook-xml' 'docbook-xsl' )
optdepends=('wireless_management: wifimgr')
source=(ftp://ftp.archlinux.org/other/community/$pkgname/$pkgname-$pkgver.tar.xz
        lxpanel-0.5.12-automake-1.13-support.patch
	patch-src__plugins__batt__batt.c
	patch-src__plugins__batt__batt_sys.c
	patch-src__plugins__batt__batt_sys.h)
sha256sums=('c29997c522f138e4beb02fc549c84136fc840a836c1f69b400d90d2d4e91de1b'
            'b5774aa79b65faa740d5be37f98d8f2baa71a05a36f6decb45a0d16658f5512f'
            '8058bef6d5f344f15125b96bd01250b5aa8db1823147594cbd7f134de98847c1'
            'ce8114b99e0af89eda91d0dee1d47ae7cb886ccebee3fd616bfaeb47e41b8f93'
            '216f69ae28f541b00e848eb7bbce44897834717001d8170a19d4f08647f62a21')

build() {
  cd $srcdir/$pkgname-$pkgver
   unset CC CPP CXX
   patch -Np0 -i $srcdir/lxpanel-0.5.12-automake-1.13-support.patch
  ./autogen.sh
   patch -p0 -i $srcdir/patch-src__plugins__batt__batt_sys.h
   patch -p0 -i $srcdir/patch-src__plugins__batt__batt_sys.c
   patch -p0 -i $srcdir/patch-src__plugins__batt__batt.c

  sed -i '' -e 's,linux,sys,' \
                 $srcdir/$pkgname-$pkgver/src/plugins/volume/volume-impl.c
  sed -i ''  -e 's,$$(DATADIRNAME)/locale,share/locale,' \
                 $srcdir/$pkgname-$pkgver/po/Makefile.in.in

  CFLAGS+=' -lgmodule-2.0' ./configure \
    --sysconfdir=/etc \
    --prefix=/usr \
    --with-plugins=volume,deskno,kbled,xkb,batt \
    --disable-alsa \
    --enable-man \
    CPPFLAGS="-I/usr/local/include" \
    LDFLAGS="-L/usr/local/lib"
  gmake
}

package() {
  cd $srcdir/$pkgname-$pkgver
  make DESTDIR=$pkgdir install
}
