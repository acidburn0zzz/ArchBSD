# Written by: Amzo
pkgbase="freebsd"
pkgname="${pkgbase}-world"
pkgver=9.1
pkgdesc="FreeBSD 9.1 world package"
pkgrel=4
groups=(base)
arch=('i686' 'x86_64')
url="http://freebsd.org"
source=('loader.conf'
	'sysctl.conf'
        'freebsdworld.install'
	'src.conf')

md5sums=('a0207b6316254bf13409e4feb574640f'
         'de332851385c7219c51d7254236bde1f'
         'bf0d50295ffc8a23b4dc6bced65f5500'
         '3b79aa8dae89b5894e7a012ca361542d')

install=freebsdworld.install
license=('BSD')
makedepends=("freebsd-source")
options=('docs')

build() {

# Building

cd /usr/src
if [[ "$ARCH" == "x86_64" ]]; then
		make TARGET=amd64 clean
		make buildworld TARGET=amd64 DESTDIR="$pkgdir" || (echo buildworld failed... && return 1)
else
                make TARGET=i386 DESTDIR="$pkgdir" buildworld || (echo buildworld failed... && return 1)

fi
}


# Package kernel

package() {

cd /usr/src

if [[ "$CARCH" == "x86_64" ]]; then
        cd /usr/src
        make TARGET=amd64 DESTDIR="$pkgdir"  SRCONF=${srcdir}/src.conf installworld distribution|| (echo buildworld failed... && return 1)
else
        make DESTDIR="$pkgdir" TARGET=i386 installworld 
fi

#remove rc tools for openrc
rm -rfi ${pkgdir}/etc/rc*
rm -rfi ${pkgdir}/usr/share/man/man8/rc.8.gz

#install some files
install -m644 $srcdir/loader.conf ${pkgdir}/boot/
install -m644 $srcdir/sysctl.conf ${pkgdir}/etc/

backup=('boot/device.hints'
	'boot/loader.conf')

cd "$pkgdir"

for f in `find -E etc -type f ! -regex ".*periodic.*|.*rc\..*|etc.rc|.*mtree.*|.*defaults.*|.*README|.*Makefile"` `find root var -type f`; do
	backup=(${backup[@]} "${f}")
done
}

